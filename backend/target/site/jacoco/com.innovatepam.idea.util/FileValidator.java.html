<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="tr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FileValidator.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">InnovatEPAM Auth Service</a> &gt; <a href="index.source.html" class="el_package">com.innovatepam.idea.util</a> &gt; <span class="el_source">FileValidator.java</span></div><h1>FileValidator.java</h1><pre class="source lang-java linenums">package com.innovatepam.idea.util;

import java.util.Arrays;
import java.util.List;
import java.util.Locale;

import org.springframework.web.multipart.MultipartFile;

import com.innovatepam.idea.model.FileType;

/**
 * Validates file uploads for idea attachments.
 * 
 * Enforces:
 * - Allowed file types: PDF, PNG
 * - Maximum file size: 50MB (52,428,800 bytes)
 */
<span class="nc" id="L18">public class FileValidator {</span>
    
    public static final long MAX_FILE_SIZE = 52_428_800L; // 50MB in bytes
<span class="fc" id="L21">    private static final List&lt;String&gt; ALLOWED_CONTENT_TYPES = Arrays.asList(</span>
        &quot;application/pdf&quot;,
        &quot;image/png&quot;
    );
<span class="fc" id="L25">    private static final List&lt;String&gt; ALLOWED_EXTENSIONS = Arrays.asList(&quot;pdf&quot;, &quot;png&quot;);</span>
    
    /**
     * Validates if the uploaded file meets all requirements.
     * 
     * @param file The uploaded file to validate
     * @return ValidationResult containing validation status and error message if any
     */
    public static ValidationResult validate(MultipartFile file) {
<span class="fc bfc" id="L34" title="All 4 branches covered.">        if (file == null || file.isEmpty()) {</span>
<span class="fc" id="L35">            return ValidationResult.invalid(&quot;File is required&quot;);</span>
        }
        
        // Check file size
<span class="fc bfc" id="L39" title="All 2 branches covered.">        if (file.getSize() &gt; MAX_FILE_SIZE) {</span>
<span class="fc" id="L40">            return ValidationResult.invalid(</span>
<span class="fc" id="L41">                String.format(&quot;File size exceeds maximum allowed size of 50MB (received: %.2f MB)&quot;, </span>
<span class="fc" id="L42">                    file.getSize() / 1024.0 / 1024.0)</span>
            );
        }
        
        // Check content type
<span class="fc" id="L47">        String contentType = file.getContentType();</span>
<span class="pc bpc" id="L48" title="1 of 4 branches missed.">        if (contentType == null || !ALLOWED_CONTENT_TYPES.contains(contentType.toLowerCase(Locale.ROOT))) {</span>
<span class="fc" id="L49">            return ValidationResult.invalid(</span>
<span class="fc" id="L50">                String.format(&quot;File type '%s' is not allowed. Allowed types: PDF, PNG&quot;, contentType)</span>
            );
        }
        
        // Check file extension
<span class="fc" id="L55">        String originalFilename = file.getOriginalFilename();</span>
<span class="pc bpc" id="L56" title="1 of 4 branches missed.">        if (originalFilename == null || originalFilename.isEmpty()) {</span>
<span class="fc" id="L57">            return ValidationResult.invalid(&quot;Filename is required&quot;);</span>
        }
        
<span class="fc" id="L60">        String extension = getFileExtension(originalFilename);</span>
<span class="pc bpc" id="L61" title="1 of 2 branches missed.">        if (!ALLOWED_EXTENSIONS.contains(extension.toLowerCase())) {</span>
<span class="nc" id="L62">            return ValidationResult.invalid(</span>
<span class="nc" id="L63">                String.format(&quot;File extension '.%s' is not allowed. Allowed extensions: pdf, png&quot;, extension)</span>
            );
        }
        
<span class="fc" id="L67">        return ValidationResult.valid();</span>
    }
    
    /**
     * Determines the FileType enum from a MultipartFile based on content type.
     * 
     * @param file The uploaded file
     * @return FileType enum (PDF or PNG)
     * @throws IllegalArgumentException if file type is not supported
     */
    public static FileType getFileType(MultipartFile file) {
<span class="fc" id="L78">        String contentType = file.getContentType();</span>
<span class="pc bpc" id="L79" title="1 of 2 branches missed.">        if (contentType == null) {</span>
<span class="nc" id="L80">            throw new IllegalArgumentException(&quot;Content type is null&quot;);</span>
        }
        
<span class="fc bfc" id="L83" title="All 3 branches covered.">        return switch (contentType.toLowerCase(Locale.ROOT)) {</span>
<span class="fc" id="L84">            case &quot;application/pdf&quot; -&gt; FileType.PDF;</span>
<span class="fc" id="L85">            case &quot;image/png&quot; -&gt; FileType.PNG;</span>
<span class="fc" id="L86">            default -&gt; throw new IllegalArgumentException(&quot;Unsupported file type: &quot; + contentType);</span>
        };
    }
    
    /**
     * Extracts the file extension from a filename.
     * 
     * @param filename The filename
     * @return The file extension (without dot) or empty string if no extension
     */
    public static String getFileExtension(String filename) {
<span class="fc bfc" id="L97" title="All 4 branches covered.">        if (filename == null || filename.isEmpty()) {</span>
<span class="fc" id="L98">            return &quot;&quot;;</span>
        }
        
<span class="fc" id="L101">        int lastDotIndex = filename.lastIndexOf('.');</span>
<span class="pc bpc" id="L102" title="1 of 4 branches missed.">        if (lastDotIndex == -1 || lastDotIndex == filename.length() - 1) {</span>
<span class="fc" id="L103">            return &quot;&quot;;</span>
        }
        
<span class="fc" id="L106">        return filename.substring(lastDotIndex + 1);</span>
    }
    
    /**
     * Result of file validation containing status and optional error message.
     */
    public static class ValidationResult {
        private final boolean valid;
        private final String errorMessage;
        
<span class="fc" id="L116">        private ValidationResult(boolean valid, String errorMessage) {</span>
<span class="fc" id="L117">            this.valid = valid;</span>
<span class="fc" id="L118">            this.errorMessage = errorMessage;</span>
<span class="fc" id="L119">        }</span>
        
        public static ValidationResult valid() {
<span class="fc" id="L122">            return new ValidationResult(true, null);</span>
        }
        
        public static ValidationResult invalid(String errorMessage) {
<span class="fc" id="L126">            return new ValidationResult(false, errorMessage);</span>
        }
        
        public boolean isValid() {
<span class="fc" id="L130">            return valid;</span>
        }
        
        public String getErrorMessage() {
<span class="fc" id="L134">            return errorMessage;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>